<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <script type="importmap">
        {
          "imports": {
            "three": "https://unpkg.com/three@0.162.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.162.0/examples/jsm/"
          }
        }
    </script>
    <script type="module" src="./js/GLTFCanvas.js"></script>
    <script type="module">
        import { GLTFCanvas } from './js/GLTFCanvas.js';
        import { ImageService } from './js/ImageService.js'



        const cameraPosition = { x: 0, y: 0.25, z: 0.45 };
        const modelPosition = { x: -0.135, y: 0.115, z: 0.16 };

        const canvas = new GLTFCanvas(cameraPosition, './assets/background.jpg', 1280, 720);
        document.body.appendChild(canvas.getRendererDom());



        const connection = new WebSocket("ws://localhost:3000/")
        connection.onmessage = async (e) => {
            let urlData = URL.createObjectURL(new Blob([e.data]))
            canvas.loadModel(modelPosition, urlData);

            while(!canvas.isCompleted) {
                await new Promise(r => setTimeout(r, 1000));
            }

            var img = imgService.get(document.getElementsByTagName('canvas')[0]);
            connection.send(img)
            //imgService.download(document.getElementsByTagName('canvas')[0])
        }
    </script>
</head>
<body>
</body>
</html>